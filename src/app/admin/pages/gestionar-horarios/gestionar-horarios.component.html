@if(loading){
  <mat-progress-bar mode="indeterminate" class="-mt-7 mb-8"></mat-progress-bar>
}
<div class="mx-5 mt-2">
  <p class="text-xl font-medium mb-4">Gestionar Horarios</p>
  <div class="flex gap-x-5">
    <div class="w-3/5">
      <p class="font-normal text-sm mb-3">Seleccione las opciones para buscar el horario de un salón en específico:</p>
      <div class="bg-gray-50 p-2 rounded-xl ring-1 ring-gray-300">
        <div class="flex justify-center gap-x-3 pt-1 -mb-3">
          <mat-form-field appearance="fill" class="col-span-2 sm:col-span-1">
            <mat-label>Periodo Escolar</mat-label>
            <mat-select 
              [(ngModel)]="periodo.periodo_id"
              [ngModelOptions]="{standalone: true}"
              (ngModelChange)="listarGrados()"
            >
              <mat-option 
                *ngFor="let e of periodos" 
                [value]="e.periodo_id"
              >
                {{ e.anio }}
              </mat-option>
            </mat-select>
          </mat-form-field>
    
          <mat-form-field appearance="fill" class="col-span-2 sm:col-span-1">
            <mat-label>Grado</mat-label>
            <mat-select 
              [(ngModel)]="horario.grado_id"
              [ngModelOptions]="{standalone: true}"
              [disabled]="!gradosLoaded"
              (ngModelChange)="listarSeccionesPorPeriodoGrado()"
              (ngModelChange)="listarCursosPorGrado()"
            >
              <mat-option 
                *ngFor="let e of grados" 
                [value]="e.grado_id"
              >
                {{ e.nombre }}
              </mat-option>
            </mat-select>
          </mat-form-field>
    
          <mat-form-field appearance="fill" class="col-span-2 sm:col-span-1">
            <mat-label>Seccion</mat-label>
            <mat-select 
              [(ngModel)]="horario.seccion_id"
              [ngModelOptions]="{standalone: true}"
              [disabled]="!seccionLoaded"
            >
              <mat-option 
                *ngFor="let e of secciones" 
                [value]="e.seccion.seccion_id"
              >
                {{ e.seccion.aula + ', ' + e.seccion.nombre }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </div>
    </div>
    <div class="w-2/5">
      <p class="font-normal text-sm mb-3">Seleccione el curso y docente:</p>
      <div class="bg-gray-50 p-2 rounded-xl ring-1 ring-gray-300">
        <div class="flex justify-center gap-x-3 pt-1 -mb-3">
          <mat-form-field appearance="fill" class="col-span-2 sm:col-span-1">
            <mat-label>Cursos</mat-label>
            <mat-select 
              [(ngModel)]="horario.curso_id"
              [ngModelOptions]="{standalone: true}"
              [disabled]="!cursosLoaded"
              (ngModelChange)="listarDocentesPorCurso()"
            >
              <mat-option 
                *ngFor="let e of cursos" 
                [value]="e.curso_id"
              >
                {{ e.nombre }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="fill" class="col-span-2 sm:col-span-1">
            <mat-label>Docentes</mat-label>
            <mat-select 
              [(ngModel)]="horario.docente_id"
              [ngModelOptions]="{standalone: true}"
              [disabled]="!docentesLoaded"
            >
              <mat-option 
                *ngFor="let e of docentes" 
                [value]="e.docente_id"
              >
                {{ e.apellido + ', ' + e.nombre }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </div>
    </div>
  </div>
  
  <div class="flex mt-4 gap-x-2">
    <div class="flex flex-col w-[170px] gap-y-3 ps-2 pt-2">

        <button 
          (click)="listarHorariosPorGradoSeccion()"
          mat-flat-button 
          color="custom-color" 
        >
          <i class="fa-solid fa-magnifying-glass me-1.5"></i>Buscar Horario 
        </button>

        @if(horarioLoaded) {
          <button 
            (click)="listarHorariosPorGradoSeccion()"
            mat-flat-button 
            color="custom-color" 
          >
            <i class="fa-solid fa-file-excel me-1.5"></i>Descargar .xlsx
          </button>
        }
    </div>

    <div class="overflow-x-auto w-full">
      <div class="inline-block min-w-full align-middle p-2">
        <div 
          class="overflow-hidden shadow ring-1 ring-black ring-opacity-5 rounded-lg bg-gray-50"
          [ngClass]="{ 'h-10' : !horarioLoaded }"
        >
        @if(!horarioLoaded) {
          <p class="flex justify-center pt-2.5 text-sm font-normal uppercase">Sección del horario</p>
        }
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Hora</th>
                <th *ngFor="let day of days" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">{{ day }}</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              <tr *ngFor="let time of times">
                <td class="px-6 py-3 whitespace-nowrap text-sm text-gray-500">{{ time }}</td>
                <td *ngFor="let day of days"
                    (click)="selectCell(day, time)"
                    [ngClass]="{'bg-blue-200': isSelected(day, time)}"
                    class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 cursor-pointer"
                    [attr.data-day]="day"
                    [attr.data-time]="time">
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>  
  </div>
</div>